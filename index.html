<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HTML/CSS/JS –ü–µ—Å–æ—á–Ω–∏—Ü–∞</title>

    <!-- Tailwind: dark mode by class -->
    <script>window.tailwind = window.tailwind || {}; window.tailwind.config = { darkMode: 'class' };</script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 + Babel (JSX compiler; IMPORTANT: presets added) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- CodeMirror + Lint -->
    <link rel="stylesheet" href="https://unpkg.com/codemirror@5.65.16/lib/codemirror.css" />
    <link rel="stylesheet" href="https://unpkg.com/codemirror@5.65.16/theme/material-darker.css" />
    <link rel="stylesheet" href="https://unpkg.com/codemirror@5.65.16/addon/lint/lint.css" />
    <script src="https://unpkg.com/codemirror@5.65.16/lib/codemirror.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/mode/xml/xml.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/mode/javascript/javascript.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/mode/css/css.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/mode/htmlmixed/htmlmixed.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/addon/lint/lint.js"></script>
    <script src="https://unpkg.com/jshint@2.13.6/dist/jshint.js"></script>
    <script src="https://unpkg.com/csslint@1.0.5/dist/csslint.js"></script>
    <script src="https://unpkg.com/htmlhint@0.16.3/dist/htmlhint.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/addon/lint/javascript-lint.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/addon/lint/css-lint.js"></script>
    <script src="https://unpkg.com/codemirror@5.65.16/addon/lint/html-lint.js"></script>

    <meta name="color-scheme" content="dark light" />
    <style>
      .CodeMirror { height: 60vh; }
      @media (min-width: 1024px) { .CodeMirror { height: 70vh; } }
      img.logo { image-rendering: -webkit-optimize-contrast; }
    </style>
  </head>
  <body class="bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100">
    <noscript style="display:block; padding:16px; color:#b91c1c; background:#fee2e2">–î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–µ–Ω JavaScript</noscript>
    <div id="root"></div>

    <!-- NOTE: add data-presets so JSX compiles even from file:// -->
    <script type="text/babel" data-presets="env,react">
      const { useEffect, useMemo, useRef, useState } = React;

      function useTheme(){
        const getInitial=()=>{
          const s=localStorage.getItem('theme');
          if(s==='light'||s==='dark') return s;
          return window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        };
        const [t,setT]=useState(getInitial);
        useEffect(()=>{
          const r=document.documentElement;
          if(t==='dark') r.classList.add('dark'); else r.classList.remove('dark');
          localStorage.setItem('theme',t);
        },[t]);
        return [t,setT];
      }

      function PlaygroundPage(){
        return (<main className="min-h-screen p-4 md:p-6">
          <div className="max-w-[1400px] mx-auto"><CodePlayground/></div>
        </main>);
      }

      function CodePlayground(){
        const [theme,setTheme]=useTheme();
        const LS=useMemo(()=>({html:'play_html',css:'play_css',js:'play_js'}),[]);
        const DEF=useMemo(()=>({html:`<!-- –ò–∑–º–µ–Ω–∏ –º–µ–Ω—è! -->
<div class="app">
  <h1>Hello, world! üëã</h1>
  <button id="btn">–ù–∞–∂–º–∏ –º–µ–Ω—è</button>
  <p class="note">–ü—Ä–∞–≤—å HTML, CSS –∏ JS –Ω–∞ –≤–∫–ª–∞–¥–∫–∞—Ö —Å–ª–µ–≤–∞, –∑–∞—Ç–µ–º –∂–º–∏ "–ó–∞–ø—É—Å–∫"</p>
</div>`,css:`.app {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  padding: 24px;
}
:root { --bg:#0b1220; --panel:#0f172a; --text:#0b1220; --text-dark:#e5e7eb; --accent:#4f46e5; }
body { color-scheme: light dark; }
button { background: var(--accent); border:0; color:#fff; padding:8px 12px; border-radius:10px; cursor:pointer;}
.note{opacity:.8;}`,js:`const btn=document.getElementById('btn');
btn.addEventListener('click',()=>{
  btn.textContent='üöÄ –ü–æ–µ—Ö–∞–ª–∏!';
  console.log('–ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞');
  alert('JavaScript —Ä–∞–±–æ—Ç–∞–µ—Ç!');
});`}),[]);

        const [html,setHtml]=useState(''),[css,setCss]=useState(''),[js,setJs]=useState(''),[tab,setTab]=useState('html'),[logs,setLogs]=useState([]),[device,setDevice]=useState('desktop');
        const iframeRef=useRef(null), fileInputRef=useRef(null);
        const cmH=useRef(null), cmC=useRef(null), cmJ=useRef(null);
        const hostH=useRef(null), hostC=useRef(null), hostJ=useRef(null);

        useEffect(()=>{
          const h=localStorage.getItem(LS.html)??DEF.html;
          const c=localStorage.getItem(LS.css)??DEF.css;
          const j=localStorage.getItem(LS.js)??DEF.js;
          setHtml(h); setCss(c); setJs(j);
          const th=(localStorage.getItem('theme')==='dark')?'material-darker':'default';
          cmH.current=CodeMirror(hostH.current,{value:h,mode:'htmlmixed',theme:th,lineNumbers:true,gutters:['CodeMirror-linenumbers','CodeMirror-lint-markers'],lint:true});
          cmH.current.on('change',cm=>{const v=cm.getValue(); setHtml(v); localStorage.setItem(LS.html,v);});
          cmC.current=CodeMirror(hostC.current,{value:c,mode:'css',theme:th,lineNumbers:true,gutters:['CodeMirror-linenumbers','CodeMirror-lint-markers'],lint:true});
          cmC.current.on('change',cm=>{const v=cm.getValue(); setCss(v); localStorage.setItem(LS.css,v);});
          cmJ.current=CodeMirror(hostJ.current,{value:j,mode:'javascript',theme:th,lineNumbers:true,gutters:['CodeMirror-linenumbers','CodeMirror-lint-markers'],lint:true});
          cmJ.current.on('change',cm=>{const v=cm.getValue(); setJs(v); localStorage.setItem(LS.js,v);});

          // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–¥–∏–Ω —Ä–∞–∑
          setTimeout(()=>run(), 100);
        },[]);

        useEffect(()=>{
          const t=theme==='dark'?'material-darker':'default';
          cmH.current&&cmH.current.setOption('theme',t);
          cmC.current&&cmC.current.setOption('theme',t);
          cmJ.current&&cmJ.current.setOption('theme',t);
        },[theme]);

        useEffect(()=>{
          setTimeout(()=>{
            if(tab==='html'&&cmH.current) cmH.current.refresh();
            if(tab==='css'&&cmC.current) cmC.current.refresh();
            if(tab==='js'&&cmJ.current) cmJ.current.refresh();
          },0);
        },[tab]);

        const setEditors=(h,c,j)=>{ cmH.current?.setValue(h); cmC.current?.setValue(c); cmJ.current?.setValue(j); };

        const build=()=>`<!doctype html><html lang=\"ru\"><head><meta charset=\"utf-8\"/><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/><style>${css}</style></head><body>${html}
<script>(function(){const p=window.parent;function post(t,a){try{p.postMessage({__sandboxLog:true,type:t,payload:a},'*')}catch(e){}}
['log','info','warn','error'].forEach(fn=>{const o=console[fn].bind(console);console[fn]=function(){post(fn,Array.from(arguments).map(a=>{try{return typeof a==='object'?JSON.stringify(a):String(a)}catch(e){return String(a)}}));o.apply(console,arguments);};});
window.addEventListener('error',function(e){post('error',[e.message||'Error',e.filename?e.filename+':'+e.lineno+':'+e.colno:'']);});})();<\/script>
<script>try{${js}}catch(e){console.error(e && e.stack ? e.stack : e.toString());}<\/script>
</body></html>`;

        const addLog=e=>setLogs(p=>[...p,e].slice(-500)), clearLogs=()=>setLogs([]);

        useEffect(()=>{
          const onMsg=e=>{const d=e.data; if(!d||!d.__sandboxLog) return; addLog({level:d.type,text:(d.payload||[]).join(' ')}); };
          window.addEventListener('message',onMsg);
          return()=>window.removeEventListener('message',onMsg);
        },[]);

        const run=()=>{
          const i=iframeRef.current;
          if(!i) return;
          addLog({level:'info',text:'–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞‚Ä¶'});
          i.srcdoc=build();
        };

        const exportPr=()=>{
          const p={version:1,html,css,js,exportedAt:new Date().toISOString()};
          const b=new Blob([JSON.stringify(p,null,2)],{type:'application/json'});
          const u=URL.createObjectURL(b);
          const a=document.createElement('a'); a.href=u; a.download=\`playground-project-\${Date.now()}.json\`; a.click(); URL.revokeObjectURL(u);
        };

        const onPick=()=>fileInputRef.current?.click();
        const onImport=async e=>{
          const f=e.target.files?.[0]; e.target.value=''; if(!f) return;
          try{
            const t=await f.text(); const d=JSON.parse(t);
            if(typeof d!=='object'||typeof d.html!=='string'||typeof d.css!=='string'||typeof d.js!=='string') throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –û–∂–∏–¥–∞–µ—Ç—Å—è JSON —Å –ø–æ–ª—è–º–∏ html/css/js.');
            setHtml(d.html); setCss(d.css); setJs(d.js);
            setEditors(d.html,d.css,d.js);
            setTimeout(run,0);
          }catch(err){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç: '+(err?.message??err)); }
        };

        const deviceWidth=()=> device==='desktop'?1440 : device==='tablet'?768 : 375;

        return (<div>
          <header className="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
            <div className="flex items-center gap-3"><img src="./logo.webp" alt="Logo" className="logo h-8 w-auto select-none" /></div>
            <div className="flex flex-wrap items-center gap-2">
              <button onClick={()=>setTheme(theme==='dark'?'light':'dark')} className="px-3 py-2 rounded-2xl shadow-md bg-slate-200 text-slate-900 hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">{theme==='dark'?'üåô –¢—ë–º–Ω–∞—è':'üåû –°–≤–µ—Ç–ª–∞—è'}</button>
              <select value={device} onChange={(e)=>setDevice(e.target.value)} className="px-3 py-2 rounded-2xl bg-slate-200 text-slate-900 dark:bg-slate-700 dark:text-slate-100">
                <option value="desktop">–î–µ—Å–∫—Ç–æ–ø 1440px</option>
                <option value="tablet">–ü–ª–∞–Ω—à–µ—Ç 768px</option>
                <option value="mobile">–ú–æ–±–∏–ª—å–Ω—ã–π 375px</option>
              </select>
              <button onClick={run} className="px-4 py-2 rounded-2xl shadow-md bg-indigo-600 hover:bg-indigo-500 active:scale-[.99] transition" title="–ó–∞–ø—É—Å–∫ (Ctrl/Cmd + Enter)">‚ñ∂ –ó–∞–ø—É—Å–∫</button>
              <button onClick={exportPr} className="px-4 py-2 rounded-2xl shadow-md bg-emerald-600 hover:bg-emerald-500 active:scale-[.99] transition" title="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ JSON">‚§ì –≠–∫—Å–ø–æ—Ä—Ç</button>
              <button onClick={onPick} className="px-4 py-2 rounded-2xl shadow-md bg-slate-200 text-slate-900 hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600" title="–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∏–∑ JSON">‚§í –ò–º–ø–æ—Ä—Ç</button>
              <input ref={fileInputRef} type="file" accept="application/json" className="hidden" onChange={onImport} />
            </div>
          </header>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div className="rounded-2xl bg-slate-100 border border-slate-300 overflow-hidden dark:bg-slate-800/60 dark:border-slate-700">
              <Tabs value={tab} onChange={setTab} />
              <div className="p-0">
                <div className={tab==='html'?'block':'hidden'}><div ref={hostH}/></div>
                <div className={tab==='css'?'block':'hidden'}><div ref={hostC}/></div>
                <div className={tab==='js'?'block':'hidden'}><div ref={hostJ}/></div>
              </div>
            </div>

            <div className="rounded-2xl bg-slate-100 border border-slate-300 overflow-hidden flex flex-col dark:bg-slate-800/60 dark:border-slate-700">
              <div className="px-4 py-2 text-sm border-b border-slate-300 flex items-center justify-between dark:border-slate-700"><span className="opacity-80">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</span><span className="opacity-60">iframe sandbox</span></div>
              <div className="w-full flex justify-center p-3">
                <div className="border border-slate-300 dark:border-slate-700 rounded-xl overflow-hidden shadow-sm max-w-full" style={{width: deviceWidth() + 'px'}}>
                  <iframe ref={iframeRef} title="preview" className="w-full h-[60vh] lg:h-[70vh] bg-white" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-presentation allow-same-origin allow-scripts"></iframe>
                </div>
              </div>
            </div>
          </div>

          <section className="mt-4 rounded-2xl bg-slate-100 border border-slate-300 overflow-hidden dark:bg-slate-800/60 dark:border-slate-700">
            <div className="px-4 py-2 text-sm border-b border-slate-300 flex items-center justify-between dark:border-slate-700">
              <span className="opacity-80">–ö–æ–Ω—Å–æ–ª—å</span>
              <div className="flex items-center gap-2">
                <button onClick={()=>clearLogs()} className="text-xs px-2 py-1 rounded bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600">–û—á–∏—Å—Ç–∏—Ç—å</button>
              </div>
            </div>
            <div className="max-h-[30vh] overflow-auto font-mono text-xs p-3 space-y-1 bg-white dark:bg-slate-900">
              {logs.length===0 && <div className="opacity-50">–í—ã–≤–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (–∏–ª–∏ –∏–∑ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ console.log).</div>}
              {logs.map((l,i)=>(<div key={i} className={l.level==='error'?'text-red-600 dark:text-red-400':l.level==='warn'?'text-yellow-700 dark:text-yellow-300':l.level==='info'?'text-sky-700 dark:text-sky-300':'text-slate-700 dark:text-slate-200'}><span className="opacity-60">[{l.level}]</span> {l.text}</div>))}
            </div>
          </section>
        </div>);
      }

      function Tabs({value,onChange}){
        const Item=(id,label)=>(<button key={id} onClick={()=>onChange(id)} className={"px-4 py-2 text-sm md:text-base transition border-b-2 -mb-[1px] "+(value===id?"border-indigo-600 text-indigo-700 bg-indigo-50 dark:border-indigo-500 dark:text-indigo-300 dark:bg-slate-800":"border-transparent text-slate-600 hover:text-slate-900 hover:bg-slate-100 dark:text-slate-300 dark:hover:text-white dark:hover:bg-slate-700/50")}>{label}</button>);
        return <div className="flex items-center gap-1 bg-slate-50 border-b border-slate-300 dark:bg-slate-900/60 dark:border-slate-700">{Item('html','HTML')}{Item('css','CSS')}{Item('js','JS')}</div>;
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<PlaygroundPage/>);
    </script>
  </body>
</html>
